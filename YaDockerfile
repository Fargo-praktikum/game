FROM node:14.17.0-alpine as build
WORKDIR /app
COPY . .
RUN npm install
RUN NODE_ENV=production npm run webpack-prod


FROM node:14.17.0-alpine
EXPOSE 5000
COPY --from=build /app/dist /app/dist
COPY --from=build /app/serverDist /app/serverDist
COPY --from=build /app/node_modules /app/node_modules
COPY --from=build /app/migrations /app/migrations
COPY --from=build /app/ya-docker-entrypoint.sh /app/ya-docker-entrypoint.sh
RUN chmod +x /app/ya-docker-entrypoint.sh
ENTRYPOINT ["/app/ya-docker-entrypoint.sh"]
